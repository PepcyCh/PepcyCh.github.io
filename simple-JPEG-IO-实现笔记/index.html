<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/assets/favicon.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/assets/favicon.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="文档：https:&#x2F;&#x2F;www.w3.org&#x2F;Graphics&#x2F;JPEG&#x2F;itu-t81.pdf 实现参考：  stb_image：https:&#x2F;&#x2F;github.com&#x2F;nothings&#x2F;stb&#x2F;blob&#x2F;master&#x2F;stb_image.h Game Engine From Scratch：https:&#x2F;&#x2F;github.com&#x2F;netwarm007&#x2F;GameEngineFromScratch&#x2F;bl">
<meta property="og:type" content="article">
<meta property="og:title" content="simple-JPEG-IO 实现笔记">
<meta property="og:url" content="http://pepcy.cf/simple-JPEG-IO-%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="PepcyCh&#39;s Blog">
<meta property="og:description" content="文档：https:&#x2F;&#x2F;www.w3.org&#x2F;Graphics&#x2F;JPEG&#x2F;itu-t81.pdf 实现参考：  stb_image：https:&#x2F;&#x2F;github.com&#x2F;nothings&#x2F;stb&#x2F;blob&#x2F;master&#x2F;stb_image.h Game Engine From Scratch：https:&#x2F;&#x2F;github.com&#x2F;netwarm007&#x2F;GameEngineFromScratch&#x2F;bl">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-10-31T04:21:08.000Z">
<meta property="article:modified_time" content="2020-08-06T07:17:48.105Z">
<meta property="article:author" content="Pepcy_Ch">
<meta property="article:tag" content="随笔">
<meta property="article:tag" content="实现笔记">
<meta name="twitter:card" content="summary"><title>simple-JPEG-IO 实现笔记 | PepcyCh's Blog</title><link ref="canonical" href="http://pepcy.cf/simple-JPEG-IO-%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><script src="https://www.googletagmanager.com/gtag/js?id=UA-102451976-1" async=""></script><script>if (window.location.hostname !== 'localhost') {
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'UA-102451976-1');
}</script><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">关于</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">搜索</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">PepcyCh's Blog</div><div class="header-banner-info__subtitle"></div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">simple-JPEG-IO 实现笔记</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2019-10-31</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2020-08-06</span></span></div></header><div class="post-body"><p>文档：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.w3.org/Graphics/JPEG/itu-t81.pdf" >https://www.w3.org/Graphics/JPEG/itu-t81.pdf</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>实现参考：</p>
<ul>
<li>stb_image：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/nothings/stb/blob/master/stb_image.h" >https://github.com/nothings/stb/blob/master/stb_image.h</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
<li>Game Engine From Scratch：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/netwarm007/GameEngineFromScratch/blob/master/Framework/Parser/JPEG.hpp" >https://github.com/netwarm007/GameEngineFromScratch/blob/master/Framework/Parser/JPEG.hpp</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li>
</ul>
<hr />
<p>前些日子写学校里图像信息处理的作业时想着不用 BMP 而直接用 JPEG 会方便很多，本来也想写这么一个轮子，所以就花了些时间实现出了这么一个玩意儿。本文就算是我写这个东西时的学习笔记了，因为重心放在了解析上，输出只是随便糊了一个最基本的，所以大部分内容都是站在解析的角度上记录的。</p>
<p>simple-JPEG-IO：<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/PepcyCh/simple-JPEG-IO" >https://github.com/PepcyCh/simple-JPEG-IO</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<hr />
<p>笔记大概分为四个部分：</p>
<ul>
<li>大致压缩流程</li>
<li>基本文件结构</li>
<li>解析流程</li>
<li>输出流程</li>
</ul>
<a id="more"></a>

        <h2 id="大致压缩流程"   >
          <a href="#大致压缩流程" class="heading-link"><i class="fas fa-link"></i></a>大致压缩流程</h2>
      
<p>把图像分成若干 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的块，右侧和下侧超出的部分用边界值填充。</p>
<p>对于每一个块，先转化至 YCbCr 空间，之后分通道进行压缩。</p>
<p>首先对该块进行 DCT。</p>
<p>之后对 DCT 后得到的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的矩阵中的每一个元素分别除以一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的量化矩阵中的相应元素并向下取整。</p>
<p>在每一个 Restart Interval 内（见「基本文件结构-DRI」），除第一个 DC 系数（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的块中左上角的值）外，每一个 DC 系数对前一个块的 DC 系数做差；AC 系数（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的块中除左上角以外的值）使用 Run-length Code 压缩（具体见「基本文件结构-熵编码部分」）。</p>
<p>之后使用 Huffman 编码进行压缩（Huffman 编码的不是 DC 或 AC 系数，具体见「基本文件结构-熵编码部分」）。</p>
<hr />
<p>JPEG 使用的 DCT 公式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>S</mi><mrow><mi>v</mi><mi>u</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><msub><mi>c</mi><mi>u</mi></msub><msub><mi>c</mi><mi>v</mi></msub><munderover><mo>∑</mo><mrow><mi>x</mi><mo>=</mo><mn>0</mn></mrow><mn>7</mn></munderover><munderover><mo>∑</mo><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><mn>7</mn></munderover><msub><mi>s</mi><mrow><mi>y</mi><mi>x</mi></mrow></msub><mi>cos</mi><mo>⁡</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi>u</mi><mi>π</mi></mrow><mn>16</mn></mfrac><mi>cos</mi><mo>⁡</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>2</mn><mi>y</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi>v</mi><mi>π</mi></mrow><mn>16</mn></mfrac></mrow><annotation encoding="application/x-tex">S_{vu} = \frac{1}{4} c_u c_v \sum_{x = 0}^{7} \sum_{y = 0}^{7} s_{yx} \cos \frac{(2x + 1) u \pi}{16} \cos \frac{(2y + 1) v \pi}{16}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2043340000000002em;vertical-align:-1.403221em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.801113em;"><span style="top:-1.8828869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.403221em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">6</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">6</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>IDCT 公式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>s</mi><mrow><mi>y</mi><mi>x</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mn>4</mn></mfrac><munderover><mo>∑</mo><mrow><mi>u</mi><mo>=</mo><mn>0</mn></mrow><mn>7</mn></munderover><munderover><mo>∑</mo><mrow><mi>v</mi><mo>=</mo><mn>0</mn></mrow><mn>7</mn></munderover><msub><mi>c</mi><mi>u</mi></msub><msub><mi>c</mi><mi>v</mi></msub><msub><mi>s</mi><mrow><mi>v</mi><mi>u</mi></mrow></msub><mi>cos</mi><mo>⁡</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi>u</mi><mi>π</mi></mrow><mn>16</mn></mfrac><mi>cos</mi><mo>⁡</mo><mfrac><mrow><mo stretchy="false">(</mo><mn>2</mn><mi>y</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mi>v</mi><mi>π</mi></mrow><mn>16</mn></mfrac></mrow><annotation encoding="application/x-tex">s_{yx} = \frac{1}{4} \sum_{u = 0}^{7} \sum_{v = 0}^{7} c_u c_v s_{vu} \cos \frac{(2x + 1) u \pi}{16} \cos \frac{(2y + 1) v \pi}{16}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.068226em;vertical-align:-1.267113em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">u</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.882887em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.267113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">6</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">6</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault" style="margin-right:0.03588em;">π</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>u</mi></msub><mo separator="true">,</mo><msub><mi>c</mi><mi>v</mi></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo separator="true">,</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo separator="true">,</mo><mtext>otherwise</mtext></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">c_u, c_v = \begin{cases}
\frac{1}{\sqrt{2}} &amp;, u, v = 0 \\
1 &amp;, \text{otherwise}
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0000299999999998em;vertical-align:-1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7429999999999999em;"><span style="top:-3.743em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.5510085em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.912845em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.872845em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.12715500000000002em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5379999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.197em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2429999999999999em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7429999999999999em;"><span style="top:-3.743em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-2.197em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">otherwise</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2429999999999999em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>

        <h2 id="基本文件结构"   >
          <a href="#基本文件结构" class="heading-link"><i class="fas fa-link"></i></a>基本文件结构</h2>
      
<p>JPEG 文件中使用大端法。</p>
<p>JPEG 文件由若干块组成，每一块的开头是一个 2 字节长的块标识符，第一字节均为 <code>0xFF</code>。除图像首尾的块 SOI（Start Of Image）、EOI（End Of Image）和一些块外，大部分块在 2 字节的块标识符后还有一个 2 字节的部分表示块的长度，该长度包括自己的 2 字节，但不包括块标识符。</p>
<p>根据压缩流程中所描述的，要正确解析一个 JPEG 图像，只需要考虑以下块：</p>
<ul>
<li>SOI（Start Of Image）</li>
<li>EOI（End Of Image）</li>
<li>SOFn（Start Of  Frame）</li>
<li>DQT（Define Quantization Table）</li>
<li>DHT（Define Huffman Table）</li>
<li>SOS（Start Of Scan）</li>
<li>DRI（Define Restart Interval）</li>
<li>RST（Restart）</li>
</ul>
<p>除此之外，还要了解真正存储图像的熵编码部分。</p>
<p>之后将依次介绍以上每一个块。</p>

        <h3 id="soistart-of-image"   >
          <a href="#soistart-of-image" class="heading-link"><i class="fas fa-link"></i></a>SOI（Start Of Image）</h3>
      
<p>块标识符：<code>0xFFD8</code></p>
<p>除标识符外无其他内容，出现在文件最开始。</p>

        <h3 id="eoiend-of-image"   >
          <a href="#eoiend-of-image" class="heading-link"><i class="fas fa-link"></i></a>EOI（End Of Image）</h3>
      
<p>块标识符：<code>0xFFD9</code></p>
<p>除标识符外无其他内容，出现在文件最末尾。</p>

        <h3 id="sofnstart-of-frame"   >
          <a href="#sofnstart-of-frame" class="heading-link"><i class="fas fa-link"></i></a>SOFn（Start Of Frame）</h3>
      
<p>块标识符：<code>0xFFCn</code>（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>=</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><mtext>F</mtext></mrow><annotation encoding="application/x-tex">n = 0, 1, \dots, \text{F}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">F</span></span></span></span></span>）</p>
<p>常用的有 SOF0 和 SOF2，分别表示基线模式（Baseline DCT）和连续模式（Progressive DCT）。</p>
<p>该块描述了一些图像的基本信息。</p>
<p>其块内容可表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Lf</mtext><mtext>  </mtext><mtext>  </mtext><mtext>P</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Y</mtext><mtext>  </mtext><mtext>  </mtext><mtext>X</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Nf</mtext><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Ck</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Hk</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Vk</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Tqk</mtext><msub><mo stretchy="false">)</mo><mrow><mn>1</mn><mo>∼</mo><mtext>Nf</mtext></mrow></msub></mrow><annotation encoding="application/x-tex">\text{Lf} \;\; \text{P} \;\; \text{Y} \;\; \text{X} \;\; \text{Nf} \;\; (\text{Ck} \;\; \text{Hk} \;\; \text{Vk} \;\; \text{Tqk})_{1 \sim \text{Nf}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Lf</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">P</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Y</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">X</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Nf</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Ck</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Hk</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Vk</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Tqk</span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord text mtight"><span class="mord mtight">Nf</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>

        <h4 id="textlfframe-header-length-16bits"   >
          <a href="#textlfframe-header-length-16bits" class="heading-link"><i class="fas fa-link"></i></a>Lf\text{Lf}Lf：Frame Header Length - 16bits</h4>
      
<p>块长度，等于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>+</mo><mn>3</mn><mtext>Nf</mtext></mrow><annotation encoding="application/x-tex">8 + 3\text{Nf}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord text"><span class="mord">Nf</span></span></span></span></span></p>

        <h4 id="textpsample-precision-8bits"   >
          <a href="#textpsample-precision-8bits" class="heading-link"><i class="fas fa-link"></i></a>P\text{P}P：Sample Precision - 8bits</h4>
      
<p>可取的值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>12</mn></mrow><annotation encoding="application/x-tex">12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span>，基线模式下只能为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span>。simple-JPEG-IO 只考虑了为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的情况，实践中还未因此受到影响。</p>

        <h4 id="textynumber-of-lines-16bits"   >
          <a href="#textynumber-of-lines-16bits" class="heading-link"><i class="fas fa-link"></i></a>Y\text{Y}Y：Number of Lines - 16bits</h4>
      
<p>图像的高度。若为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 则表示由 DNL（Define Number of Lines）块定义，本文不考虑这种情况。</p>

        <h4 id="textxnumber-of-samples-per-line-16bits"   >
          <a href="#textxnumber-of-samples-per-line-16bits" class="heading-link"><i class="fas fa-link"></i></a>X\text{X}X：Number of Samples per Line - 16bits</h4>
      
<p>图像的宽度。</p>

        <h4 id="textnfnumber-of-image-components-in-frame-8bits"   >
          <a href="#textnfnumber-of-image-components-in-frame-8bits" class="heading-link"><i class="fas fa-link"></i></a>Nf\text{Nf}Nf：Number of Image Components in Frame - 8bits</h4>
      
<p>图像的通道数。一般为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>，按顺序分别为 Y、Cb、Cr。</p>

        <h4 id="textckcomponent-identifier-8bits"   >
          <a href="#textckcomponent-identifier-8bits" class="heading-link"><i class="fas fa-link"></i></a>Ck\text{Ck}Ck：Component Identifier - 8bits</h4>
      
<p>该通道的编号。</p>

        <h4 id="texthkhorizontal-sampling-factor-4bits"   >
          <a href="#texthkhorizontal-sampling-factor-4bits" class="heading-link"><i class="fas fa-link"></i></a>Hk\text{Hk}Hk：Horizontal Sampling Factor - 4bits</h4>
      
<p>水平采样因子，具体解释见「解析流程」。</p>

        <h4 id="textvkvertical-sampling-factor-4bits"   >
          <a href="#textvkvertical-sampling-factor-4bits" class="heading-link"><i class="fas fa-link"></i></a>Vk\text{Vk}Vk：Vertical Sampling Factor - 4bits</h4>
      
<p>竖直采样因子，具体解释见「解析流程」。</p>

        <h4 id="texttqkquantization-table-destination-selector-8bits"   >
          <a href="#texttqkquantization-table-destination-selector-8bits" class="heading-link"><i class="fas fa-link"></i></a>Tqk\text{Tqk}Tqk：Quantization Table Destination Selector - 8bits</h4>
      
<p>该通道使用的量化表的编号（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">0 \sim 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>）。</p>

        <h3 id="dqtdefine-quantization-table"   >
          <a href="#dqtdefine-quantization-table" class="heading-link"><i class="fas fa-link"></i></a>DQT（Define Quantization Table）</h3>
      
<p>块标识符：<code>0xFFDB</code></p>
<p>该块定义了一个或多个量化表。</p>
<p>一个定义了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> 个量化表的块内容可表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Lq</mtext><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Pq</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Tq</mtext><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Qk</mtext><msub><mo stretchy="false">)</mo><mrow><mn>0</mn><mo>∼</mo><mn>63</mn></mrow></msub><msub><mo stretchy="false">)</mo><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\text{Lq} \;\; (\text{Pq} \;\; \text{Tq} \;\; (\text{Qk})_{0 \sim 63})_{1 \sim n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Lq</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Pq</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Tq</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Qk</span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mrel mtight">∼</span><span class="mord mtight">6</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>

        <h4 id="textlqquantization-table-defination-length-16bits"   >
          <a href="#textlqquantization-table-defination-length-16bits" class="heading-link"><i class="fas fa-link"></i></a>Lq\text{Lq}Lq：Quantization Table Defination Length - 16bits</h4>
      
<p>块长度。</p>

        <h4 id="textpqquantization-table-element-precision-4bits"   >
          <a href="#textpqquantization-table-element-precision-4bits" class="heading-link"><i class="fas fa-link"></i></a>Pq\text{Pq}Pq：Quantization Table Element Precision - 4bits</h4>
      
<p>可取的值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 或 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，若为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，表示该表的每一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Qk</mtext></mrow><annotation encoding="application/x-tex">\text{Qk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Qk</span></span></span></span></span> 占 8bits，否则表示占 16bits。基线模式下只能为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>。</p>

        <h4 id="texttqquantization-table-destination-identifier-4bits"   >
          <a href="#texttqquantization-table-destination-identifier-4bits" class="heading-link"><i class="fas fa-link"></i></a>Tq\text{Tq}Tq：Quantization Table Destination Identifier - 4bits</h4>
      
<p>该量化表的编号，取值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">0 \sim 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>，用于 SOFn 的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Tqk</mtext></mrow><annotation encoding="application/x-tex">\text{Tqk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Tqk</span></span></span></span></span>。</p>

        <h4 id="textqkquantization-table-elements-8bits16bits"   >
          <a href="#textqkquantization-table-elements-8bits16bits" class="heading-link"><i class="fas fa-link"></i></a>Qk\text{Qk}Qk：Quantization Table Elements - 8bits/16bits</h4>
      
<p>量化表的每一个元素，按 zig-zag 序给出。</p>

        <h3 id="dhtdefine-huffman-table"   >
          <a href="#dhtdefine-huffman-table" class="heading-link"><i class="fas fa-link"></i></a>DHT（Define Huffman Table）</h3>
      
<p>块标识符：<code>0xFFC4</code></p>
<p>该块定义了一个或多个 Huffman 表。</p>
<p>一个定义了 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span> 个 Huffman 表的块内容可表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Lh</mtext><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Tc</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Th</mtext><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Lk</mtext><msub><mo stretchy="false">)</mo><mrow><mn>1</mn><mo>∼</mo><mn>16</mn></mrow></msub><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Vi,j</mtext><msub><mo stretchy="false">)</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>∼</mo><mn>16</mn><mo separator="true">,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo>∼</mo><mtext>Li</mtext></mrow></msub><msub><mo stretchy="false">)</mo><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\text{Lh} \;\; (\text{Tc} \;\; \text{Th} \;\; (\text{Lk})_{1 \sim 16} \;\; (\text{Vi,j})_{i=1 \sim 16, j = 1 \sim \text{Li}})_{1 \sim n}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord text"><span class="mord">Lh</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Tc</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Th</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Lk</span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Vi,j</span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.328331em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord mtight">1</span><span class="mord mtight">6</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord text mtight"><span class="mord mtight">Li</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>

        <h4 id="textlhhuffman-table-defination-length-16bits"   >
          <a href="#textlhhuffman-table-defination-length-16bits" class="heading-link"><i class="fas fa-link"></i></a>Lh\text{Lh}Lh：Huffman Table Defination Length - 16bits</h4>
      
<p>块长度。</p>

        <h4 id="texttctable-class-4bits"   >
          <a href="#texttctable-class-4bits" class="heading-link"><i class="fas fa-link"></i></a>Tc\text{Tc}Tc：Table Class - 4bits</h4>
      
<p>若为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，表示是一个 DC 表；若为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，表示是一个 AC 表。</p>

        <h4 id="textthhuffman-table-destination-identifier-4bits"   >
          <a href="#textthhuffman-table-destination-identifier-4bits" class="heading-link"><i class="fas fa-link"></i></a>Th\text{Th}Th：Huffman Table Destination Identifier - 4bits</h4>
      
<p>Huffman 表的编号，取值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>∼</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">0 \sim 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>（基线模式下取值为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>∼</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">0 \sim 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>），编号相同但类别不同的 Huffman 表不是同一个表（也就是一共最多会有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 个表）。</p>

        <h4 id="textlknumber-of-huffman-codes-of-length-k-8bits"   >
          <a href="#textlknumber-of-huffman-codes-of-length-k-8bits" class="heading-link"><i class="fas fa-link"></i></a>Lk\text{Lk}Lk：Number of Huffman Codes of Length kkk - 8bits</h4>
      
<p>长度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 的 Huffman 码的个数。</p>

        <h4 id="textvijvalue-associated-with-each-huffman-code-8bits"   >
          <a href="#textvijvalue-associated-with-each-huffman-code-8bits" class="heading-link"><i class="fas fa-link"></i></a>Vi,j\text{Vi,j}Vi,j：Value Associated with Each Huffman Code - 8bits</h4>
      
<p>长度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathdefault">i</span></span></span></span> 的第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> 个 Huffman 码表示的值。</p>
<p>具体的编码方式将在「解析流程」中给出。</p>

        <h3 id="sosstart-of-scan"   >
          <a href="#sosstart-of-scan" class="heading-link"><i class="fas fa-link"></i></a>SOS（Start Of Scan）</h3>
      
<p>块标识符：<code>0xFFDA</code></p>
<p>该块标识着一次扫描的开始，若为基线模式，则只会有一个 SOS 块。紧接其后的就是熵编码的扫描内容。</p>
<p>其块内容可表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ls</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Ns</mtext><mtext>  </mtext><mtext>  </mtext><mo stretchy="false">(</mo><mtext>Csk</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Tdk</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Tak</mtext><msub><mo stretchy="false">)</mo><mrow><mn>1</mn><mo>∼</mo><mtext>Ns</mtext></mrow></msub><mtext>  </mtext><mtext>  </mtext><mtext>Ss</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Se</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Ah</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Ls} \;\; \text{Ns} \;\; (\text{Csk} \;\; \text{Tdk} \;\; \text{Tak})_{1 \sim \text{Ns}} \;\; \text{Ss} \;\; \text{Se} \;\; \text{Ah} \;\; \text{Al}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Ls</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Ns</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord">Csk</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Tdk</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Tak</span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mrel mtight">∼</span><span class="mord text mtight"><span class="mord mtight">Ns</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Ss</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Se</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Ah</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span></span></p>

        <h4 id="textlsscan-header-length-16bits"   >
          <a href="#textlsscan-header-length-16bits" class="heading-link"><i class="fas fa-link"></i></a>Ls\text{Ls}Ls：Scan Header Length - 16bits</h4>
      
<p>块长度，不含熵编码部分。</p>

        <h4 id="textnsnumber-of-image-components-in-scan-8bits"   >
          <a href="#textnsnumber-of-image-components-in-scan-8bits" class="heading-link"><i class="fas fa-link"></i></a>Ns\text{Ns}Ns：Number of Image Components in Scan - 8bits</h4>
      
<p>该次扫描内涉及的通道数。</p>

        <h4 id="textcskscan-component-selector-8bits"   >
          <a href="#textcskscan-component-selector-8bits" class="heading-link"><i class="fas fa-link"></i></a>Csk\text{Csk}Csk：Scan Component Selector - 8bits</h4>
      
<p>扫描内第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span> 个通道的编号，该编号就是在 SOFn 中定义的编号。</p>

        <h4 id="texttdkdc-entropy-coding-table-destination-selector-4bits"   >
          <a href="#texttdkdc-entropy-coding-table-destination-selector-4bits" class="heading-link"><i class="fas fa-link"></i></a>Tdk\text{Tdk}Tdk：DC Entropy Coding Table Destination Selector - 4bits</h4>
      
<p>该通道使用的 DC 表的编号，该编号就是 DHT 中定义的编号。</p>

        <h4 id="texttakac-entropy-coding-table-destination-selector-4bits"   >
          <a href="#texttakac-entropy-coding-table-destination-selector-4bits" class="heading-link"><i class="fas fa-link"></i></a>Tak\text{Tak}Tak：AC Entropy Coding Table Destination Selector - 4bits</h4>
      
<p>该通道使用的 AC 表的编号，该编号就是 DHT 中定义的编号。</p>

        <h4 id="textssstart-of-spectral-of-predictor-selection-8bits"   >
          <a href="#textssstart-of-spectral-of-predictor-selection-8bits" class="heading-link"><i class="fas fa-link"></i></a>Ss\text{Ss}Ss：Start of Spectral of Predictor Selection - 8bits</h4>
      
<p>连续模式时，该次扫描涉及的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 块内第一个元素的 zig-zag 序下标，其及剩下的参数将在「解析流程-连续模式」中做进一步解释。</p>
<p>基线模式下一定为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>。</p>

        <h4 id="textseend-of-spectral-of-predictor-selection-8bits"   >
          <a href="#textseend-of-spectral-of-predictor-selection-8bits" class="heading-link"><i class="fas fa-link"></i></a>Se\text{Se}Se：End of Spectral of Predictor Selection - 8bits</h4>
      
<p>连续模式时，该次扫描涉及的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 块内最后一个元素的 zig-zag 序下标。</p>
<p>基线模式下一定为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>63</mn></mrow><annotation encoding="application/x-tex">63</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">3</span></span></span></span>。</p>

        <h4 id="textahsuccessive-approximation-bit-position-high-4bits"   >
          <a href="#textahsuccessive-approximation-bit-position-high-4bits" class="heading-link"><i class="fas fa-link"></i></a>Ah\text{Ah}Ah：Successive Approximation Bit Position High - 4bits</h4>
      
<p>连续模式时，为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 表示是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ss</mtext><mo>∼</mo><mtext>Se</mtext></mrow><annotation encoding="application/x-tex">\text{Ss} \sim \text{Se}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Ss</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Se</span></span></span></span></span> 的 DCT 系数的第一次扫描，否则是之后的扫描。</p>
<p>基线模式下一定为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>。</p>

        <h4 id="textalsuccessive-approximation-bit-position-low-4bits"   >
          <a href="#textalsuccessive-approximation-bit-position-low-4bits" class="heading-link"><i class="fas fa-link"></i></a>Al\text{Al}Al：Successive Approximation Bit Position Low - 4bits</h4>
      
<p>连续模式时，该次扫描涉及的每一个 DCT 系数的位移系数。</p>
<p>基线模式下一定为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>。</p>

        <h3 id="dridefine-restart-interval"   >
          <a href="#dridefine-restart-interval" class="heading-link"><i class="fas fa-link"></i></a>DRI（Define Restart Interval）</h3>
      
<p>块标识符：<code>0xFFDD</code></p>
<p>该块定义了 restart interval 的长度，每当扫描后的熵编码部分已经解析或编码了长度的整数倍的 MCU（Minimum Coded Unit，最小编码单元，将在「解析流程」中做进一步解释） 时暂时结束熵编码部分，同时清零已保存的当前的 DC 值，之后遇到 RST（Restart）块时将继续进行接下来的扫描。如果无 DRI 块，则可以认为 restart interval 的长度为 0，之后也不会有 RST 块。</p>
<p>比如，Photoshop 的基线模式会把图像的每一行设成一个 restart interval，那么文件中会是「SOS，第一行数据，RST，第二行数据，……，RST，最后一行数据」。</p>
<p>当熵编码部分结束时不是一个满的字节时，需要填充满。</p>
<p>其块内容可以表示为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Lr</mtext><mtext>  </mtext><mtext>  </mtext><mtext>Ri</mtext></mrow><annotation encoding="application/x-tex">\text{Lr} \;\; \text{Ri}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Lr</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">Ri</span></span></span></span></span></span></p>

        <h4 id="textlrdefine-restart-interval-segment-length-16bits"   >
          <a href="#textlrdefine-restart-interval-segment-length-16bits" class="heading-link"><i class="fas fa-link"></i></a>Lr\text{Lr}Lr：Define Restart Interval Segment Length - 16bits</h4>
      
<p>块长度，等于 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>。</p>

        <h4 id="textrirestart-interval-16bits"   >
          <a href="#textrirestart-interval-16bits" class="heading-link"><i class="fas fa-link"></i></a>Ri\text{Ri}Ri：Restart Interval - 16bits</h4>
      
<p>定义的长度。</p>

        <h3 id="rstrestart"   >
          <a href="#rstrestart" class="heading-link"><i class="fas fa-link"></i></a>RST（Restart）</h3>
      
<p>块标识符：<code>0xFFD7</code></p>
<p>无内容，紧接其后的是熵编码的扫描内容。</p>

        <h3 id="熵编码部分"   >
          <a href="#熵编码部分" class="heading-link"><i class="fas fa-link"></i></a>熵编码部分</h3>
      
<p>此外，需要了解熵编码部分的结构，每一个数值的存储如下：</p>
<p>首先是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRRSSSS</mtext></mrow><annotation encoding="application/x-tex">\text{RRRRSSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRRSSSS</span></span></span></span></span> ，一个 8 位的数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRR</mtext></mrow><annotation encoding="application/x-tex">\text{RRRR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRR</span></span></span></span></span> 表示在它之前为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 的元素个数（对于 DC 系数，应当是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>），<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>SSSS</mtext></mrow><annotation encoding="application/x-tex">\text{SSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">SSSS</span></span></span></span></span> 表示存储该数值需要的位数。这个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRRSSSS</mtext></mrow><annotation encoding="application/x-tex">\text{RRRRSSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRRSSSS</span></span></span></span></span> 便是用 Huffman 表编码的东西，也就是说，存储的是编码后的 Huffman 码。在基线模式下，DC 系数的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>SSSS</mtext></mrow><annotation encoding="application/x-tex">\text{SSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">SSSS</span></span></span></span></span> 的取值范围是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>∼</mo><mn>11</mn></mrow><annotation encoding="application/x-tex">0 \sim 11</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">1</span></span></span></span>，AC 系数的取值范围是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>∼</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">1 \sim 10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span>，所以基线模式下的一个 DC 表会有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>12</mn></mrow><annotation encoding="application/x-tex">12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span> 个元素，一个 AC 表会有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>162</mn></mrow><annotation encoding="application/x-tex">162</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">2</span></span></span></span> 个元素（包括了之后提到的 ZRL 和 EOB），一些解析器（如 Photoshop 的）需要 Huffman 表正好有这么多的元素才视作可解析的 JPEG 文件。</p>
<p>之后才是真正的数值，读取 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>SSSS</mtext></mrow><annotation encoding="application/x-tex">\text{SSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">SSSS</span></span></span></span></span> 长的二进制数，根据下表可以得到真正的数值：</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:center">长度</th>
<th style="text-align:center">所编码的数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">-1, 1</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">-3, -2, 2, 3</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">-7, -6, -5, -4, 4, 5, 6, 7</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">-15 ~ -8, 8 ~ 15</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">-31 ~ -16, 16 ~ 31</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">-63 ~ -32, 32 ~ 63</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">-127 ~ -64, 64 ~ 127</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">-255 ~ -128, 128 ~ 255</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">-511 ~ -256, 256 ~ 511</td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center">-1023 ~ -512, 512 ~ 1023</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center">-2047 ~ -1024, 1024 ~ 2047</td>
</tr>
</tbody>
</table></div>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRR</mtext></mrow><annotation encoding="application/x-tex">\text{RRRR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRR</span></span></span></span></span> 指示之前为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 的数据数，但显然它最多只能表示 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>15</mn></mrow><annotation encoding="application/x-tex">15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span></span></span></span> 个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，于是定义 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRRSSSS</mtext><mo>=</mo><mtext>0xF0</mtext></mrow><annotation encoding="application/x-tex">\text{RRRRSSSS} = \text{0xF0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRRSSSS</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">0xF0</span></span></span></span></span> 为 ZRL（Zero Run Length），表示连续的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span></span></span></span> 个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>（如果不做特殊处理，理解成一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 的前面有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>15</mn></mrow><annotation encoding="application/x-tex">15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span></span></span></span> 个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 也是可以得到正确结果的）；同时，可能会出现从当前到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 块的最后一个数都是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 的情况，用 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRRSSSS</mtext><mo>=</mo><mn>0</mn><mi>x</mi><mn>00</mn></mrow><annotation encoding="application/x-tex">\text{RRRRSSSS} = 0x00</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRRSSSS</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mord">0</span><span class="mord">0</span></span></span></span> 表示，该值被称作 EOB（End Of Block）。在连续模式中会有一些变化，将在「解析流程-连续模式」中进一步说明。</p>
<p>很明显，在熵编码部分中可能出现 <code>0xFF</code> 这半个块标识符，而熵编码部分又不像 SOS、SOFn 这样的块用 2 字节指示了长度，所以规定，如果出现了 <code>0xFF</code>，在其后需要追加一个无意义的 <code>0x00</code>，称为「bitstuff」，解析时应先去除这样的 <code>0x00</code>。</p>

        <h2 id="解析流程"   >
          <a href="#解析流程" class="heading-link"><i class="fas fa-link"></i></a>解析流程</h2>
      

        <h3 id="基线模式"   >
          <a href="#基线模式" class="heading-link"><i class="fas fa-link"></i></a>基线模式</h3>
      
<p>很多东西在基线模式和连续模式下都是相同或相似的，就都在「基线模式」中描述了。</p>
<p>根据 JPEG 文件结构的特性，很容易想到用一个 <code>while</code> 循环控制，依次解析各个块，直至遇到 EOI 块结束。</p>

        <h4 id="根据-dht-的信息建立-huffman-树"   >
          <a href="#根据-dht-的信息建立-huffman-树" class="heading-link"><i class="fas fa-link"></i></a>根据 DHT 的信息建立 Huffman 树</h4>
      
<p>按顺序考虑每一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Vi,j</mtext></mrow><annotation encoding="application/x-tex">\text{Vi,j}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Vi,j</span></span></span></span></span>，记录一个当前的编码 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">curr</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>，初始为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，当没有长度为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的编码时，在后面补 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，直至找到一个最小的长度 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span></span></span></span> 使 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ll</mtext><mi mathvariant="normal">≠</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{Ll} \neq 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Ll</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>V</mi><mrow><mi>l</mi><mo separator="true">,</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">V_{l,1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mpunct mtight">,</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 分配编码 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">curr</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span>，之后 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi></mrow><annotation encoding="application/x-tex">curr</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span></span></span> 自增 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，之后如果仍存在相同长度的编码，重复分配和自增的操作；否则重复补零的操作。</p>

        <h4 id="采样因子-扫描与-mcu"   >
          <a href="#采样因子-扫描与-mcu" class="heading-link"><i class="fas fa-link"></i></a>采样因子、扫描与 MCU</h4>
      
<p>MCU（Minimum Coded Unit），最小编码单元，即在一次扫描过程中最小的处理单元，在扫描过程中，按先从左到右、后从上到下的顺序依次处理每一个 MCU。</p>
<p>如果一次扫描内只有一个通道，即 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ns</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{Ns} = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Ns</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，则无论该通道的采样因子取何值，MCU 都被定义成一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的块。当图像的宽或高不为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的整数倍时，在下层和右层按边界值填充。</p>
<p>否则，需要考虑不同通道的采样因子。</p>
<p>假设一副 JPEG 图像 Y、Cb、Cr 通道的水平和竖直采样因子均为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，那就是最简单的情况，此时 MCU 被定义成一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的 Y 通道、一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的 Cb 通道和一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的 Cr 通道。</p>
<p>而除此之外，还有一种常见的情况是 Y 通道的两个采样因子均为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>，Cb 和 Cr 的采样因子为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>，这意味着 Cb 和 Cr 被进行了缩小。此时，图像最左上角的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 个像素有各自的 Y 值，Cb 和 Cr 的值却公用同一个。MCU 此时的定义是一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>×</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \times 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> 的块的 Y 通道（如果称一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 为一个块）、一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1 \times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的块的 Cb 通道和一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">1 \times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 的块的 Cr 通道。这同样暗示着 Y 通道的宽高不只要填充至 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn></mrow><annotation encoding="application/x-tex">8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的整数倍，还要填充到 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>16</mn><mo>×</mo><mn>16</mn></mrow><annotation encoding="application/x-tex">16 \times 16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span></span></span></span> 的整数倍。待全部解析完毕后，需对 Cb 和 Cr 通道进行上采样以得到原始图像每个像素的值。</p>
<p>从而我们可以得到是，一个 MCU 由不同通道的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Vk</mtext><mo>×</mo><mtext>Hk</mtext></mrow><annotation encoding="application/x-tex">\text{Vk} \times \text{Hk}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord text"><span class="mord">Vk</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Hk</span></span></span></span></span> 的块组成，采样因子最大的那一通道的相应维是没有经过下采样的。</p>
<hr />
<p>在各个块和熵编码部分都解析完毕后，对每一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 的块进行 IDCT，对需要上采样的通道上采样，最后转为 RGB 空间。</p>

        <h3 id="连续模式"   >
          <a href="#连续模式" class="heading-link"><i class="fas fa-link"></i></a>连续模式</h3>
      
<p>连续模式与基线模式最大的区别就是 SOS 块中的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ss</mtext><mo separator="true">,</mo><mtext>Se</mtext><mo separator="true">,</mo><mtext>Ah</mtext><mo separator="true">,</mo><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Ss}, \text{Se}, \text{Ah}, \text{Al}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Ss</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">Se</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">Ah</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span> 了。</p>
<p>连续模式的目的是，当只解析了部分熵编码后，能得到一个完整但不精确的图像，具体的实现方法就是把基线模式中对一个 MCU 的处理分成几个部分，放在不同的扫描中。</p>
<p>对一个 MCU 内的信息的拆分有两种，一是把一个 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>8</mn><mo>×</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">8 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">8</span></span></span></span> 块的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>64</mn></mrow><annotation encoding="application/x-tex">64</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">4</span></span></span></span> 个数据分段，二是把每一个数按二进制位分段。</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ss</mtext></mrow><annotation encoding="application/x-tex">\text{Ss}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Ss</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Se</mtext></mrow><annotation encoding="application/x-tex">\text{Se}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Se</span></span></span></span></span> 对应的是第一种，表示本次扫描只有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>64</mn></mrow><annotation encoding="application/x-tex">64</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord">4</span></span></span></span> 个数中 zig-zag 序下标 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ss</mtext><mo>∼</mo><mtext>Se</mtext></mrow><annotation encoding="application/x-tex">\text{Ss} \sim \text{Se}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Ss</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Se</span></span></span></span></span> 的数据。特别的，规定 AC 和 DC 不应混在一起，也就是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ss</mtext><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{Ss} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Ss</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 时必有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Se</mtext><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{Se} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Se</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Se</mtext><mi mathvariant="normal">≠</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{Se} \neq 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Se</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 则 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ss</mtext><mi mathvariant="normal">≠</mi><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{Ss} \neq 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">Ss</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>。</p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Ah</mtext></mrow><annotation encoding="application/x-tex">\text{Ah}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Ah</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Al}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span> 对应的是第二种。在第一次扫描时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Al}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span> 表示解析出的值最后均作一次左移 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Al}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span> 位的操作，之后的扫描将一位一位地细化每一个 DCT 系数，存储的就是每个系数的第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Al}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span> 位是否需要调整。</p>
<p>还有一些其他的规定：仅包含 DC 系数的第一次扫描必须是所有扫描中的第一个扫描，仅包含 DC 系数的扫描涉及所有的通道，包含 AC 系数的扫描仅包含一个通道。</p>
<p>在 DC 系数的第一次扫描时，除了要进行左移操作外与基线模式基本相同。</p>
<p>在 AC 系数的第一次扫描时，除了要进行左移操作外，EOB 的定义也发生了变化。EOB 现在能表示的不仅是自己这一块，还表示后续的若干块均为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，此时，凡是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>SSSS</mtext><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{SSSS} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">SSSS</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 但 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRR</mtext><mi mathvariant="normal">≠</mi><mn>15</mn></mrow><annotation encoding="application/x-tex">\text{RRRR} \neq 15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">RRRR</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel"></span></span><span class="fix"></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">5</span></span></span></span> 的都是一个 EOB 标记，在其后还有长为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRR</mtext></mrow><annotation encoding="application/x-tex">\text{RRRR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRR</span></span></span></span></span> 的数表示为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 的块数（含当前所在块），该数按下表的规律解析：</p>
<div class="table-container"><table>
<thead>
<tr>
<th style="text-align:center">长度</th>
<th style="text-align:center">所编码的数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">2, 3</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">4, 5, 6, 7</td>
</tr>
<tr>
<td style="text-align:center">……</td>
<td style="text-align:center">……</td>
</tr>
</tbody>
</table></div>
<p>DC 系数的后续扫描中，按序每次读取一个二进制位，为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> 则表示相应系数的第 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>Al</mtext></mrow><annotation encoding="application/x-tex">\text{Al}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord text"><span class="mord">Al</span></span></span></span></span> 位需要调整。</p>
<p>AC 系数的后续扫描中，与之前的扫描类似，但此时一定有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>SSSS</mtext><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{SSSS} = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">SSSS</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>（除非是 ZRL 和 EOB），后一位表示该数是否需要调整，同时， <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRR</mtext></mrow><annotation encoding="application/x-tex">\text{RRRR}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRR</span></span></span></span></span> 现在表示的是在该数之前有多少个在之前的扫描中为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 的数这次仍然为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>，对于之前不为 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> 但这时被跳过去的数，是否需要调整则以类似 DC 系数后续扫描的方式缀在表示该数的那一位的后面。因 EOB 和 ZRL 而被跳过去的块也是类似的道理。</p>

        <h2 id="输出流程"   >
          <a href="#输出流程" class="heading-link"><i class="fas fa-link"></i></a>输出流程</h2>
      
<p>只要依次输出每一个必要的块的内容即可。</p>
<p>建立 Huffman 表时注意最长的编码长度不能超过 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>16</mn></mrow><annotation encoding="application/x-tex">16</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span></span></span></span>，以及所有可能出现的编码都应出现在表中，对于基线模式就是 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>12</mn></mrow><annotation encoding="application/x-tex">12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span> 个 DC 的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRRSSSS</mtext></mrow><annotation encoding="application/x-tex">\text{RRRRSSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRRSSSS</span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>162</mn></mrow><annotation encoding="application/x-tex">162</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">6</span><span class="mord">2</span></span></span></span> 个 AC 的 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>RRRRSSSS</mtext></mrow><annotation encoding="application/x-tex">\text{RRRRSSSS}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord text"><span class="mord">RRRRSSSS</span></span></span></span></span>。可以偷懒用等长编码。</p>
<p>注意在熵编码部分添加 bitstuff 和填充最后一个未满的字节。</p>
<p>量化表随便搞一个就好了，我用的是 Photoshop 输出基线模式时用的量化表。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="http://pepcy.cf">Pepcy_Ch</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="http://pepcy.cf/simple-JPEG-IO-%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/">http://pepcy.cf/simple-JPEG-IO-%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://pepcy.cf/tags/%E9%9A%8F%E7%AC%94/">随笔</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://pepcy.cf/tags/%E5%AE%9E%E7%8E%B0%E7%AC%94%E8%AE%B0/">实现笔记</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2019-CCPC-Final-%E6%B8%B8%E8%AE%B0/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">2019 CCPC-Final 游记</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2019-ICPC-%E5%8D%97%E4%BA%AC%E6%B8%B8%E8%AE%B0/"><span class="paginator-prev__text">2019 ICPC 南京游记</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E8%87%B4%E5%8E%8B%E7%BC%A9%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">
          大致压缩流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">
          基本文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#soistart-of-image"><span class="toc-number">2.1.</span> <span class="toc-text">
          SOI（Start Of Image）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eoiend-of-image"><span class="toc-number">2.2.</span> <span class="toc-text">
          EOI（End Of Image）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sofnstart-of-frame"><span class="toc-number">2.3.</span> <span class="toc-text">
          SOFn（Start Of Frame）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#textlfframe-header-length-16bits"><span class="toc-number">2.3.1.</span> <span class="toc-text">
          Lf\text{Lf}Lf：Frame Header Length - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textpsample-precision-8bits"><span class="toc-number">2.3.2.</span> <span class="toc-text">
          P\text{P}P：Sample Precision - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textynumber-of-lines-16bits"><span class="toc-number">2.3.3.</span> <span class="toc-text">
          Y\text{Y}Y：Number of Lines - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textxnumber-of-samples-per-line-16bits"><span class="toc-number">2.3.4.</span> <span class="toc-text">
          X\text{X}X：Number of Samples per Line - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textnfnumber-of-image-components-in-frame-8bits"><span class="toc-number">2.3.5.</span> <span class="toc-text">
          Nf\text{Nf}Nf：Number of Image Components in Frame - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textckcomponent-identifier-8bits"><span class="toc-number">2.3.6.</span> <span class="toc-text">
          Ck\text{Ck}Ck：Component Identifier - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#texthkhorizontal-sampling-factor-4bits"><span class="toc-number">2.3.7.</span> <span class="toc-text">
          Hk\text{Hk}Hk：Horizontal Sampling Factor - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textvkvertical-sampling-factor-4bits"><span class="toc-number">2.3.8.</span> <span class="toc-text">
          Vk\text{Vk}Vk：Vertical Sampling Factor - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#texttqkquantization-table-destination-selector-8bits"><span class="toc-number">2.3.9.</span> <span class="toc-text">
          Tqk\text{Tqk}Tqk：Quantization Table Destination Selector - 8bits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dqtdefine-quantization-table"><span class="toc-number">2.4.</span> <span class="toc-text">
          DQT（Define Quantization Table）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#textlqquantization-table-defination-length-16bits"><span class="toc-number">2.4.1.</span> <span class="toc-text">
          Lq\text{Lq}Lq：Quantization Table Defination Length - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textpqquantization-table-element-precision-4bits"><span class="toc-number">2.4.2.</span> <span class="toc-text">
          Pq\text{Pq}Pq：Quantization Table Element Precision - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#texttqquantization-table-destination-identifier-4bits"><span class="toc-number">2.4.3.</span> <span class="toc-text">
          Tq\text{Tq}Tq：Quantization Table Destination Identifier - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textqkquantization-table-elements-8bits16bits"><span class="toc-number">2.4.4.</span> <span class="toc-text">
          Qk\text{Qk}Qk：Quantization Table Elements - 8bits&#x2F;16bits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dhtdefine-huffman-table"><span class="toc-number">2.5.</span> <span class="toc-text">
          DHT（Define Huffman Table）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#textlhhuffman-table-defination-length-16bits"><span class="toc-number">2.5.1.</span> <span class="toc-text">
          Lh\text{Lh}Lh：Huffman Table Defination Length - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#texttctable-class-4bits"><span class="toc-number">2.5.2.</span> <span class="toc-text">
          Tc\text{Tc}Tc：Table Class - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textthhuffman-table-destination-identifier-4bits"><span class="toc-number">2.5.3.</span> <span class="toc-text">
          Th\text{Th}Th：Huffman Table Destination Identifier - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textlknumber-of-huffman-codes-of-length-k-8bits"><span class="toc-number">2.5.4.</span> <span class="toc-text">
          Lk\text{Lk}Lk：Number of Huffman Codes of Length kkk - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textvijvalue-associated-with-each-huffman-code-8bits"><span class="toc-number">2.5.5.</span> <span class="toc-text">
          Vi,j\text{Vi,j}Vi,j：Value Associated with Each Huffman Code - 8bits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sosstart-of-scan"><span class="toc-number">2.6.</span> <span class="toc-text">
          SOS（Start Of Scan）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#textlsscan-header-length-16bits"><span class="toc-number">2.6.1.</span> <span class="toc-text">
          Ls\text{Ls}Ls：Scan Header Length - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textnsnumber-of-image-components-in-scan-8bits"><span class="toc-number">2.6.2.</span> <span class="toc-text">
          Ns\text{Ns}Ns：Number of Image Components in Scan - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textcskscan-component-selector-8bits"><span class="toc-number">2.6.3.</span> <span class="toc-text">
          Csk\text{Csk}Csk：Scan Component Selector - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#texttdkdc-entropy-coding-table-destination-selector-4bits"><span class="toc-number">2.6.4.</span> <span class="toc-text">
          Tdk\text{Tdk}Tdk：DC Entropy Coding Table Destination Selector - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#texttakac-entropy-coding-table-destination-selector-4bits"><span class="toc-number">2.6.5.</span> <span class="toc-text">
          Tak\text{Tak}Tak：AC Entropy Coding Table Destination Selector - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textssstart-of-spectral-of-predictor-selection-8bits"><span class="toc-number">2.6.6.</span> <span class="toc-text">
          Ss\text{Ss}Ss：Start of Spectral of Predictor Selection - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textseend-of-spectral-of-predictor-selection-8bits"><span class="toc-number">2.6.7.</span> <span class="toc-text">
          Se\text{Se}Se：End of Spectral of Predictor Selection - 8bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textahsuccessive-approximation-bit-position-high-4bits"><span class="toc-number">2.6.8.</span> <span class="toc-text">
          Ah\text{Ah}Ah：Successive Approximation Bit Position High - 4bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textalsuccessive-approximation-bit-position-low-4bits"><span class="toc-number">2.6.9.</span> <span class="toc-text">
          Al\text{Al}Al：Successive Approximation Bit Position Low - 4bits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dridefine-restart-interval"><span class="toc-number">2.7.</span> <span class="toc-text">
          DRI（Define Restart Interval）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#textlrdefine-restart-interval-segment-length-16bits"><span class="toc-number">2.7.1.</span> <span class="toc-text">
          Lr\text{Lr}Lr：Define Restart Interval Segment Length - 16bits</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#textrirestart-interval-16bits"><span class="toc-number">2.7.2.</span> <span class="toc-text">
          Ri\text{Ri}Ri：Restart Interval - 16bits</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rstrestart"><span class="toc-number">2.8.</span> <span class="toc-text">
          RST（Restart）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%86%B5%E7%BC%96%E7%A0%81%E9%83%A8%E5%88%86"><span class="toc-number">2.9.</span> <span class="toc-text">
          熵编码部分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">
          解析流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%BA%BF%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">
          基线模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE-dht-%E7%9A%84%E4%BF%A1%E6%81%AF%E5%BB%BA%E7%AB%8B-huffman-%E6%A0%91"><span class="toc-number">3.1.1.</span> <span class="toc-text">
          根据 DHT 的信息建立 Huffman 树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%87%E6%A0%B7%E5%9B%A0%E5%AD%90-%E6%89%AB%E6%8F%8F%E4%B8%8E-mcu"><span class="toc-number">3.1.2.</span> <span class="toc-text">
          采样因子、扫描与 MCU</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E7%BB%AD%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">
          连续模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">
          输出流程</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/assets/avatar.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">Pepcy CHEN</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/PepcyCh" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="https://www.zhihu.com/people/pepcy-chen" target="_blank" rel="noopener" data-popover="知乎" data-popover-pos="up"><span class="sidebar-ov-social-item__icon">知</span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">195</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">6</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">131</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2017~2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Pepcy_Ch</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v5.0.0</span><span class="footer__devider">|</span><span>主题 - <a href="https://github.com/liuyib/hexo-theme-stun/" title="Stun" target="_blank" rel="noopener">Stun</a></span><span> v2.6.2</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="搜索文章（支持多关键词，请用空格分隔）"></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ 文章无标题 ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', '请输入字符');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><link href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/copy-tex.css" rel="stylesheet" type="text/css"><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/copy-tex.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script></body></html>